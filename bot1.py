import logging
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, MessageHandler, filters, ContextTypes

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞
BOT_TOKEN = "8292014510:AAHz-5Vd9NRo7IktViqxosM1m9pBkEq9vis"

# ========== –ß–ê–°–¢–¨ –° –î–ò–ê–õ–û–ì–ê–ú–ò - –ù–ê–ß–ê–õ–û ==========
DIALOGS = {
    "start": {
        "text": "–ù—É –∑–¥—Ä–∞–≤—Å—Ç–≤—É–π. –í–∏–∂—É –î–∏–º–∞ —É—Å–ø–µ–ª –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–æ–π –∫–æ–Ω—Ç–∞–∫—Ç —Ç–µ–±–µ. –í–∏–¥–∏–º–æ –æ–Ω –æ—á–µ–Ω—å –Ω–∞–¥–µ–µ—Ç—Å—è —á—Ç–æ —Ç—ã –µ–≥–æ —Å–ø–∞—Å–µ—à—å —Ö–∞-—Ö–∞-—Ö–∞",
        "options": {
            "option1": "–ö—Ç–æ —Ç—ã —Ç–∞–∫–æ–π?",
            "option2": "–í–µ—Ä–Ω–∏ –î–∏–º—É!",
            "option3": "–î–∞ –º–Ω–µ –∫–∞–∫-—Ç–æ –ø–æ—Ñ–∏–≥..."
        }
    },
    "option1": {
        "text": "–ö—Ç–æ —è —Ç–∞–∫–æ–π —Ç–µ–±—è –Ω–µ –∫–∞—Å–∞–µ—Ç—Å—è. –í—Å–µ —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å - —ç—Ç–æ —Ç–æ, —á—Ç–æ –î–∏–º–∞ —Å–µ–π—á–∞—Å —É –º–µ–Ω—è –∏ –ª—é–±–æ–µ —Ç–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ —É—Å—É–≥—É–±–∏—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é —Ö–∞-—Ö–∞-—Ö–∞",
        "options": {
            "suboption1": "*–ø—Ä–æ–º–æ–ª—á–∞—Ç—å*",
            "suboption2": "–í–µ—Ä–Ω–∏ –î–∏–º—É, –∏—Ä–æ–¥!",
        }
    },
    "option2": {
        "text": "–•–∞—Ö! –î–∞ —â–∞—Å! –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –ø–æ –∫—É—Å–æ—á–∫–∞–º –ø–æ—á—Ç–æ–π –†–æ—Å—Å–∏–∏! —Ö–∞-—Ö–∞-—Ö–∞",
        "options": {
            "suboption1": "–ú–Ω–µ –æ–Ω –Ω—É–∂–µ–Ω –¶–ï–õ–´–ú!",
            "suboption2": "–ù–∞–¥–µ—é—Å—å —Ç—ã –º–Ω–µ —Ö–æ—Ç—å –æ–¥–∏–Ω –∫—É—Å–æ—á–µ–∫ –æ—Ç–ø—Ä–∞–≤–∏—à—å?",
            "suboption3": "–ß—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ?!"
        }
    },
    "option3": {
        "text": "–î–∞? –ú–¥–∞... –°—Ç—Ä–∞–Ω–Ω—ã–π –æ–Ω –≤—ã–±–æ—Ä —Å–¥–µ–ª–∞–ª. –î—É—Ä–∞–∫ –≤–∏–¥–∞—Ç—å.\n–ù—É –Ω–∏—á–µ–≥–æ, –¥—Ä–µ–ª—å –Ω–∞—É—á–∏—Ç –µ–≥–æ –¥—É–º–∞—Ç—å —Ö–∞-—Ö–∞-—Ö–∞",
        "options": {
            "suboption4": "–ö–∞–∫ –¥—Ä–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞—É—á–∏—Ç—å –¥—É–º–∞—Ç—å?",
            "suboption5": "–û–Ω –±–µ–∑ –Ω–∞–¥–µ–∂–µ–Ω... ",
            "suboption6": "–°—Ç–æ–π! –ù–µ –Ω–∞–¥–æ!"
        }
    },
    "suboption1": {
        "text": "–•–º... –ó–Ω–∞–µ—à—å, —É –º–µ–Ω—è —Ç–∞–∫–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ö–æ—Ä–æ—à–µ–µ —Å–µ–≥–æ–¥–Ω—è. –Ø –ø–æ–¥—É–º–∞—é –æ—Ç–ø—É—Å—Ç–∏—Ç—å –î–∏–º—É, –Ω–æ —Ç—ã –¥–æ–ª–∂–µ–Ω –º–Ω–µ –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –æ–Ω –Ω–µ –æ—à–∏–±—Å—è –Ω–∞ —Å—á–µ—Ç —Ç–µ–±—è —Ö–∞-—Ö–∞-—Ö–∞\n–¢–µ–±–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å–ø—ã—Ç–∞–Ω–∏–π –æ—Ç –º–æ–∏—Ö –±—Ä–∞—Ç–∞–Ω–æ–≤. –û–Ω–∏ —Ç–µ–±–µ –ø–æ –∫—É—Å–æ—á–∫–∞–º –±—É–¥—É—Ç –≤—ã–¥–∞–≤–∞—Ç—å –∫–æ–¥. –ù—É –ª–∏–±–æ —è —Ç–µ–±–µ –±—É–¥—É –î–∏–º—É –≤—ã–¥–∞–≤–∞—Ç—å –ø–æ –∫—É—Å–æ—á–∫–∞–º –µ—Å–ª–∏ —Ç—ã –Ω–µ —Å–ø—Ä–∞–≤–∏—à—å—Å—è —Ö–∞-—Ö–∞-—Ö–∞\n–©–∞—Å –æ—Ç–ø—Ä–∞–≤–ª—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø–µ—Ä–≤–æ–≥–æ –¥—Ä—É–∂–∫–∞",
        "options": {}
    },
    "suboption2": {
        "text": "–•–º... –ó–Ω–∞–µ—à—å, —É –º–µ–Ω—è —Ç–∞–∫–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ö–æ—Ä–æ—à–µ–µ —Å–µ–≥–æ–¥–Ω—è. –Ø –ø–æ–¥—É–º–∞—é –æ—Ç–ø—É—Å—Ç–∏—Ç—å –î–∏–º—É, –Ω–æ —Ç—ã –¥–æ–ª–∂–µ–Ω –º–Ω–µ –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –æ–Ω –Ω–µ –æ—à–∏–±—é –Ω–∞ —Å—á–µ—Ç —Ç–µ–±—è —Ö–∞-—Ö–∞-—Ö–∞\n–¢–µ–±–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å–ø—ã—Ç–∞–Ω–∏–π –æ—Ç –º–æ–∏—Ö –±—Ä–∞—Ç–∞–Ω–æ–≤. –û–Ω–∏ —Ç–µ–±–µ –ø–æ –∫—É—Å–æ—á–∫–∞–º –±—É–¥—É—Ç –≤—ã–¥–∞–≤–∞—Ç—å –∫–æ–¥. –ù—É –ª–∏–±–æ —è —Ç–µ–±–µ –±—É–¥—É –î–∏–º—É –≤—ã–¥–∞–≤–∞—Ç—å –ø–æ –∫—É—Å–æ—á–∫–∞–º –µ—Å–ª–∏ —Ç—ã –Ω–µ —Å–ø—Ä–∞–≤–∏—à—å—Å—è —Ö–∞-—Ö–∞-—Ö–∞\n–©–∞—Å –æ—Ç–ø—Ä–∞–≤–ª—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø–µ—Ä–≤–æ–≥–æ –¥—Ä—É–∂–∫–∞",
        "options": {}
    },
    "suboption3": {
        "text": "–•–º... –ó–Ω–∞–µ—à—å, —É –º–µ–Ω—è —Ç–∞–∫–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ö–æ—Ä–æ—à–µ–µ —Å–µ–≥–æ–¥–Ω—è. –Ø –ø–æ–¥—É–º–∞—é –æ—Ç–ø—É—Å—Ç–∏—Ç—å –î–∏–º—É, –Ω–æ —Ç—ã –¥–æ–ª–∂–µ–Ω –º–Ω–µ –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –æ–Ω –Ω–µ –æ—à–∏–±—Å—è –Ω–∞ —Å—á–µ—Ç —Ç–µ–±—è —Ö–∞-—Ö–∞-—Ö–∞\n–¢–µ–±–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å–ø—ã—Ç–∞–Ω–∏–π –æ—Ç –º–æ–∏—Ö –±—Ä–∞—Ç–∞–Ω–æ–≤. –û–Ω–∏ —Ç–µ–±–µ –ø–æ –∫—É—Å–æ—á–∫–∞–º –±—É–¥—É—Ç –≤—ã–¥–∞–≤–∞—Ç—å –∫–æ–¥. –ù—É –ª–∏–±–æ —è —Ç–µ–±–µ –±—É–¥—É –î–∏–º—É –≤—ã–¥–∞–≤–∞—Ç—å –ø–æ –∫—É—Å–æ—á–∫–∞–º –µ—Å–ª–∏ —Ç—ã –Ω–µ —Å–ø—Ä–∞–≤–∏—à—å—Å—è —Ö–∞-—Ö–∞-—Ö–∞\n–©–∞—Å –æ—Ç–ø—Ä–∞–≤–ª—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø–µ—Ä–≤–æ–≥–æ –¥—Ä—É–∂–∫–∞",
        "options": {}
    },
    "suboption4": {
        "text": "–í–æ–∑—å–º–µ—Ç —É–∫–∞–∑–∫—É –∏ –±—É–¥–µ—Ç –≤–µ—Å—Ç–∏ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑!\n–õ–∞–¥–Ω–æ, –≤–∏–¥–∞—Ç—å –∏ —Ç—ã –Ω–µ–æ–¥–∞—Ä–µ–Ω —É–º–æ–º...\n–Ø –ø–æ–¥—É–º–∞—é –æ—Ç–ø—É—Å—Ç–∏—Ç—å –î–∏–º—É, –Ω–æ —Ç—ã –¥–æ–ª–∂–µ–Ω –º–Ω–µ –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –æ–Ω –Ω–µ –æ—à–∏–±—Å—è –Ω–∞ —Å—á–µ—Ç —Ç–µ–±—è —Ö–∞-—Ö–∞-—Ö–∞\n–¢–µ–±–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å–ø—ã—Ç–∞–Ω–∏–π –æ—Ç –º–æ–∏—Ö –±—Ä–∞—Ç–∞–Ω–æ–≤. –û–Ω–∏ —Ç–µ–±–µ –ø–æ –∫—É—Å–æ—á–∫–∞–º –±—É–¥—É—Ç –≤—ã–¥–∞–≤–∞—Ç—å –∫–æ–¥. –ù—É –ª–∏–±–æ —è —Ç–µ–±–µ –±—É–¥—É –î–∏–º—É –≤—ã–¥–∞–≤–∞—Ç—å –ø–æ –∫—É—Å–æ—á–∫–∞–º –µ—Å–ª–∏ —Ç—ã –Ω–µ —Å–ø—Ä–∞–≤–∏—à—å—Å—è —Ö–∞-—Ö–∞-—Ö–∞\n–©–∞—Å –æ—Ç–ø—Ä–∞–≤–ª—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø–µ—Ä–≤–æ–≥–æ –¥—Ä—É–∂–∫–∞",
        "options": {}
    },
    "suboption5": {
        "text": "–°–æ–≥–ª–∞—Å–µ–Ω. –û–Ω —É–∂–µ –∑–∞–¥–æ–ª–±–∞–ª —Å–≤–æ–∏–º–∏ —Ç—É–ø—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏!\n-–ï—Å–ª–∏ –±—ã —É –≤–∞—Å –±—ã–ª –±—É—Ç–µ—Ä–±—Ä–æ–¥ —Å –≤–µ—Ç—á–∏–Ω–æ–π, –∏ –≤—ã –ø–æ–∫—Ä–∞—Å–∏–ª–∏ –µ–≥–æ –≤ –∑–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç, –∫–∞–∫–æ–π —É –Ω–µ–≥–æ —Ç–µ–ø–µ—Ä—å –≤–∫—É—Å?\n–Ø –ø–æ–¥—É–º–∞—é –æ—Ç–ø—É—Å—Ç–∏—Ç—å –î–∏–º—É (–∏–ª–∏ –ø—Ä–∏–∫–æ–Ω—á–∏—Ç—å –∑–∞ –≤–æ–ø—Ä–æ—Å—ã), –Ω–æ —Ç—ã –¥–æ–ª–∂–µ–Ω –º–Ω–µ –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –æ–Ω –Ω–µ –æ—à–∏–±—Å—è –Ω–∞ —Å—á–µ—Ç —Ç–µ–±—è —Ö–∞-—Ö–∞-—Ö–∞\n–¢–µ–±–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å–ø—ã—Ç–∞–Ω–∏–π –æ—Ç –º–æ–∏—Ö –±—Ä–∞—Ç–∞–Ω–æ–≤. –û–Ω–∏ —Ç–µ–±–µ –ø–æ –∫—É—Å–æ—á–∫–∞–º –±—É–¥—É—Ç –≤—ã–¥–∞–≤–∞—Ç—å –∫–æ–¥. –ù—É –ª–∏–±–æ —è —Ç–µ–±–µ –±—É–¥—É –î–∏–º—É –≤—ã–¥–∞–≤–∞—Ç—å –ø–æ –∫—É—Å–æ—á–∫–∞–º –µ—Å–ª–∏ —Ç—ã –Ω–µ —Å–ø—Ä–∞–≤–∏—à—å—Å—è —Ö–∞-—Ö–∞-—Ö–∞\n–©–∞—Å –æ—Ç–ø—Ä–∞–≤–ª—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø–µ—Ä–≤–æ–≥–æ –¥—Ä—É–∂–∫–∞",
        "options": {}
    },
    "suboption6": {
        "text": "–•–º... –ó–Ω–∞–µ—à—å, —É –º–µ–Ω—è —Ç–∞–∫–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ö–æ—Ä–æ—à–µ–µ —Å–µ–≥–æ–¥–Ω—è. –Ø –ø–æ–¥—É–º–∞—é –æ—Ç–ø—É—Å—Ç–∏—Ç—å –î–∏–º—É, –Ω–æ —Ç—ã –¥–æ–ª–∂–µ–Ω –º–Ω–µ –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –æ–Ω –Ω–µ –æ—à–∏–±—Å—è –Ω–∞ —Å—á–µ—Ç —Ç–µ–±—è —Ö–∞-—Ö–∞-—Ö–∞\n–¢–µ–±–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å–ø—ã—Ç–∞–Ω–∏–π –æ—Ç –º–æ–∏—Ö –±—Ä–∞—Ç–∞–Ω–æ–≤. –û–Ω–∏ —Ç–µ–±–µ –ø–æ –∫—É—Å–æ—á–∫–∞–º –±—É–¥—É—Ç –≤—ã–¥–∞–≤–∞—Ç—å –∫–æ–¥. –ù—É –ª–∏–±–æ —è —Ç–µ–±–µ –±—É–¥—É –î–∏–º—É –≤—ã–¥–∞–≤–∞—Ç—å –ø–æ –∫—É—Å–æ—á–∫–∞–º –µ—Å–ª–∏ —Ç—ã –Ω–µ —Å–ø—Ä–∞–≤–∏—à—å—Å—è —Ö–∞-—Ö–∞-—Ö–∞\n–©–∞—Å –æ—Ç–ø—Ä–∞–≤–ª—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø–µ—Ä–≤–æ–≥–æ –¥—Ä—É–∂–∫–∞",
        "options": {}
    },
    "final_message": {
        "text": " –¢–µ–ø–µ—Ä—å —ç—Ç–æ –ø–∏—à—É —è (–î–∏–º–∞)üòé\n–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –≤—ã –ø—Ä–æ—à–ª–∏ –º–æ–π –º–∏–Ω–∏ –∫–≤–µ—Å—Ç! ‚ù§Ô∏è\n–ú–Ω–µ –æ—á–µ–Ω—å –ø—Ä–∏—è—Ç–Ω–æ, —á—Ç–æ –≤—ã —Ä–µ—à–∏–ª–∏ —É–¥–µ–ª–∏—Ç—å –Ω–∞ —ç—Ç–æ —Å–≤–æ–µ –≤—Ä–µ–º—è!\n\n–Ø —Ö–æ—á—É —Å–∫–∞–∑–∞—Ç—å —Å–ø–∞—Å–∏–±–æ –≤—Å–µ–º —Ç–µ–º, –∫—Ç–æ –ø—Ä–∏–Ω–∏–º–∞–ª —É—á–∞—Å—Ç–∏–µ –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏ –∑–∞ —ç—Ç–æ—Ç –≥–æ–¥, —è –≤–∞—Å –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –ª—é–±–ª—é –∏ –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –≤–∞–º–∏ –¥–æ—Ä–æ–∂—É ‚ù§Ô∏è\n–•–æ—á—É —á—Ç–æ–±—ã –≤—ã –±—ã–ª–∏ —Ä—è–¥–æ–º —Å–æ –º–Ω–æ–π –≤—Å–µ –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è. –°–ø–∞—Å–∏–±–æ –≤–∞–º –∑–∞ –≤—Å–µ ‚ù§Ô∏è",
        "options": {},
        "is_final": True  # –î–æ–±–∞–≤–ª—è–µ–º —Ñ–ª–∞–≥ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    }
}

# –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–æ—Ç–∞
NEXT_BOT_LINK = "@Zakki_ask_bot"

# –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–∏–¥–µ–æ
CORRECT_MESSAGE = "–°–ß–ê–°–¢–¨–ï=–î–†–£–ó–¨–Ø 02.11.2025"

# ========== –ß–ê–°–¢–¨ –° –î–ò–ê–õ–û–ì–ê–ú–ò - –ö–û–ù–ï–¶ ==========

# –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
user_states = {}


async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    user_id = update.effective_user.id
    user_states[user_id] = {
        "dialog_completed": False,
        "link_sent": False,
        "current_dialog": "start",
        "waiting_for_response": False,
        "message_shown": False
    }

    await show_dialog_options(update, context, "start")


async def show_dialog_options(update: Update, context: ContextTypes.DEFAULT_TYPE, dialog_key: str) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞"""
    dialog = DIALOGS.get(dialog_key)
    if not dialog:
        await send_message(update, "–î–∏–∞–ª–æ–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –¥–∏–∞–ª–æ–≥
    user_id = update.effective_user.id
    user_states[user_id]["current_dialog"] = dialog_key
    user_states[user_id]["waiting_for_response"] = True

    # –ï—Å–ª–∏ —ç—Ç–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ - –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ –∏ –∑–∞–≤–µ—Ä—à–∞–µ–º
    if dialog.get("is_final"):
        await send_message(update, dialog["text"])
        user_states[user_id]["dialog_completed"] = True
        return

    # –ï—Å–ª–∏ –Ω–µ—Ç –æ–ø—Ü–∏–π - —ç—Ç–æ –∫–æ–Ω–µ—á–Ω—ã–π –¥–∏–∞–ª–æ–≥ (–Ω–æ –Ω–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
    if not dialog.get("options"):
        await send_message(update, dialog["text"])
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –ø–æ—Å–ª–µ –∫–æ–Ω–µ—á–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
        user_states[user_id]["dialog_completed"] = True
        await send_next_bot_link(update, context)
        return

    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞
    await send_message(update, dialog["text"])

    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤
    keyboard = []
    for key, text in dialog["options"].items():
        keyboard.append([InlineKeyboardButton(text, callback_data=key)])

    reply_markup = InlineKeyboardMarkup(keyboard)
    await send_message(update, "–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç:", reply_markup=reply_markup)


async def send_message(update: Update, text: str, reply_markup=None):
    """–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è"""
    if update.callback_query:
        await update.callback_query.message.reply_text(text, reply_markup=reply_markup)
    else:
        await update.message.reply_text(text, reply_markup=reply_markup)


async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏"""
    query = update.callback_query
    await query.answer()

    user_id = query.from_user.id
    button_data = query.data

    # –ï—Å–ª–∏ –¥–∏–∞–ª–æ–≥ —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
    if user_states.get(user_id, {}).get("dialog_completed"):
        await query.edit_message_text("–î–∏–∞–ª–æ–≥ –∑–∞–≤–µ—Ä—à–µ–Ω. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.")
        return

    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
    current_dialog_key = user_states[user_id]["current_dialog"]
    current_dialog = DIALOGS.get(current_dialog_key, {})
    selected_option_text = current_dialog.get("options", {}).get(button_data, "–í—ã–±—Ä–∞–Ω –≤–∞—Ä–∏–∞–Ω—Ç")

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
    await query.message.reply_text(f"‚û§ {selected_option_text}")

    # –£–±–∏—Ä–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    await query.edit_message_reply_markup(reply_markup=None)

    # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–∏–∞–ª–æ–≥—É
    await show_dialog_options(update, context, button_data)


async def handle_user_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    user_id = update.effective_user.id
    user_state = user_states.get(user_id, {})
    message_text = update.message.text.strip()

    # –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–∏–¥–µ–æ
    if user_state.get("link_sent"):
        if message_text.lower() == CORRECT_MESSAGE.lower():
            await update.message.reply_text(
                "–û–≥–æ, –≤–∏–¥–∏–º–æ –î–∏–º–∞ –≤ —Ç–µ–±–µ –≤—Å–µ —Ç–∞–∫–∏ –Ω–µ –æ—à–∏–±—Å—è!\n–õ–∞–¥–Ω–æ, —É–±–µ–¥–∏–ª, –≤—Å–µ —Ä–∞–≤–Ω–æ –æ–Ω –º–µ–Ω—è –¥–æ—Å—Ç–∞–ª. –ü—É—Å—Ç—å –∏–¥–µ—Ç —Å –±–æ–≥–æ–º!")

            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –∫–∞–∫ –¥–∏–∞–ª–æ–≥
            await show_dialog_options(update, context, "final_message")
            user_states[user_id]["message_shown"] = True
            user_states[user_id]["link_sent"] = False

        else:
            await update.message.reply_text(f"–û–π, –∫–∞–∂–∏—Å—å —Ç—ã –æ—à–∏–±—Å—è. –ú–∏–Ω—É—Å –æ–¥–∏–Ω –ø–∞–ª—å—á–∏–∫ —É –î–∏–º—ã —Ö–∞-—Ö–∞-—Ö–∞")
        return

    # –ï—Å–ª–∏ –∂–¥–µ–º –æ—Ç–≤–µ—Ç–∞ –≤ –¥–∏–∞–ª–æ–≥–µ, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç —Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ –≤—ã–±–æ—Ä–∞ –∫–Ω–æ–ø–∫–∏
    if user_state.get("waiting_for_response") and not user_state.get("dialog_completed"):
        await update.message.reply_text("–î–∞–∂–µ —Å–ª—É—à–∞—Ç—å —Ç–µ–±—è –Ω–µ —Å—Ç–∞–Ω—É!")
        return

    # –ï—Å–ª–∏ –¥–∏–∞–ª–æ–≥ –Ω–µ –Ω–∞—á–∞—Ç
    if not user_state:
        await update.message.reply_text("–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã /start")


async def send_next_bot_link(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–æ—Ç–∞"""
    user_id = update.effective_user.id
    user_states[user_id]["link_sent"] = True

    message_text = f"–í–æ—Ç –∫–æ–Ω—Ç–∞–∫—Ç –ø–µ—Ä–≤–æ–≥–æ –¥—Ä—É–∂–∫–∞: {NEXT_BOT_LINK}\n–û–Ω –Ω–µ –æ—Å–æ–±–æ –ª—é–±–∏—Ç –≥–ª—É–ø—ã—Ö, –ø–æ—ç—Ç–æ–º—É –ø–æ–¥–∫–ª—é—á–∏ –≤—Å–µ —Å–≤–æ–∏ –∏–∑–≤–∏–ª–∏–Ω—ã, —á—Ç–æ –æ–Ω –¥–∞–ª —Ç–µ–±–µ –∫—É—Å–æ–∫ –∫–æ–¥–∞ —Ö–∞-—Ö–∞-—Ö–∞\n–ê—Ö –¥–∞, –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å–æ–±–µ—Ä–µ—à—å –≤–µ—Å—å –∫–æ–¥ - –æ—Ç–ø—Ä–∞–≤–ª—è–π –º–Ω–µ –µ–≥–æ —Å—é–¥–∞, –∞ —è –ø—Ä–æ–≤–µ—Ä—é –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ç—ã –µ–≥–æ –≤–≤–µ–ª —Ö–∞-—Ö–∞-—Ö–∞\n–ò –µ—â–µ. –ß—Ç–æ–±—ã —Ç—ã –Ω–µ –º—É—Ö–ª–µ–≤–∞–ª. –ü–æ—Å–ª–µ –∫–æ–¥–∞ —Ç–µ–±–µ –ø—Ä–∏–¥–µ—Ç—Å—è –≤–≤–µ—Å—Ç–∏ –∫–ª—é—á, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç, —á—Ç–æ —Ç—ã –ø—Ä–æ—à–µ–ª –≤—Å–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è —Ö–∞-—Ö–∞-—Ö–∞"

    await send_message(update, message_text)


async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    help_text = """
ü§ñ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:
/start - –ù–∞—á–∞—Ç—å –¥–∏–∞–ª–æ–≥
/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É
    """
    await update.message.reply_text(help_text)


def main() -> None:
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    application = Application.builder().token(BOT_TOKEN).build()

    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("help", help_command))
    application.add_handler(CallbackQueryHandler(button_handler))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_user_message))

    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    application.run_polling()


if __name__ == "__main__":
    main()